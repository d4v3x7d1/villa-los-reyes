<div class="reviews-page">

  <!-- Lista de rese√±as -->
  <section class="reviews-list">
    @if (paginatedReviews().length) {
      @for (review of paginatedReviews(); track review.id) {
        <article class="review-card">
          <header class="review-header">
            <div class="user-block">
              <img [src]="review.userPhoto || '/assets/images/default-avatar.png'"
                   alt="Avatar del usuario"
                   class="user-avatar">
              <div class="user-info">
                <span class="user-name">{{ review.userName }}</span>
                <div class="review-meta">
                  <div class="review-stars">
                    @for (s of stars; track s) {
                      <i class="fa-solid fa-star star-icon"
                         [style.color]="review.rating >= s ? '#F49516' : '#ccc'"></i>
                    }
                  </div>
                  <time class="review-date">
                    {{ review.createdAt ? (review.createdAt | date:'mediumDate') : '' }}
                  </time>
                </div>
              </div>
            </div>
          </header>

          <p class="review-text">{{ review.comment }}</p>

          <footer class="review-footer">
            <p class="useful-summary">{{ review.usefulCount || 0 }} personas la han encontrado √∫til</p>
            <div class="useful-actions">
              <span class="useful-question">¬øTe ha parecido √∫til esta opini√≥n?</span>
              <button class="btn-useful" (click)="markUseful(review)">S√≠ üëç</button>
            </div>
          </footer>
        </article>
      }

      <div class="pagination">
        <button class="page-btn" [disabled]="page() === 1" (click)="changePage(-1)">‚Üê Anterior</button>
        <span class="page-info">P√°gina {{ page() }} de {{ totalPages() }}</span>
        <button class="page-btn" [disabled]="page() === totalPages()" (click)="changePage(1)">Siguiente ‚Üí</button>
      </div>
    } @else {
      <p class="no-reviews">No hay rese√±as disponibles.</p>
    }
  </section>

  <!-- Formulario de rese√±a -->
  @if (user()) {
    <section class="review-form">
      <div class="form-header">
        <div class="user-block">
          <img [src]="user()?.photoURL || '/assets/images/default-avatar.png'"
               alt="Avatar del usuario"
               class="user-avatar">
          <span class="user-name">{{ user()?.displayName || 'Usuario' }}</span>
        </div>
      </div>

      <div class="form-body">
        <h2 class="form-title">Califica nuestros servicios</h2>

        <div class="review-stars interactive">
          @for (s of stars; track s) {
            <i class="fa-solid fa-star star-icon" (click)="rating = s" [style.color]="rating >= s ? '#F49516' : '#ccc'"></i>
          }
        </div>

        <textarea [(ngModel)]="comment" class="form-textarea" placeholder="Describe tu experiencia (opcional)" maxlength="500" rows="4"></textarea>

        <div class="char-counter">{{ commentLength }}/500 caracteres</div>

        <p class="form-note">Tu opini√≥n nos ayuda a mejorar y ofrecerte un mejor servicio.</p>

        <button class="form-submit" (click)="sendReview()">Enviar</button>
      </div>
    </section>
  } @else {
    <p class="login-hint">Inicia sesi√≥n para dejar una rese√±a.</p>
  }

</div>
