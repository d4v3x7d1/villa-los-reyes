<div class="reviews-container">
  <!-- Lista de reseÃ±as -->
  <div class="reviews-list">
    @if (reviews$ | async; as reviewsList) {
      @if (reviewsList.length > 0) {
        @for (r of reviewsList; track r.id) {
          <div class="review-card">
            <div class="header">
              @if (r.userPhoto) {
                <img [src]="r.userPhoto" [alt]="r.userName" class="user-photo">
              }
              <strong>{{ r.userName }}</strong>

              @if (r.createdAt) {
                <small class="review-date">{{ r.createdAt | date:'shortDate' }}</small>
              } @else {
                <small class="review-date">â€”</small>
              }

              <span>{{ r.rating }} â˜…</span>
            </div>

            <p>{{ r.comment }}</p>

            <div class="useful-section">
              <small>{{ r.usefulCount || 0 }} personas han encontrado Ãºtil</small>
              <div class="useful-buttons">
                @if (user$ | async; as user) {
                  <button
                    (click)="markUseful(r)"
                    [class.marked]="r.usefulBy.includes(user.uid)"
                  >
                    {{ r.usefulBy.includes(user.uid) ? 'Marcado ğŸ‘' : 'SÃ­ ğŸ‘' }}
                  </button>
                } @else {
                  <button (click)="markUseful(r)">SÃ­ ğŸ‘</button>
                }
                <button disabled>No ğŸ‘</button>
              </div>
            </div>
          </div>
        }
      } @else {
        <p>No hay reseÃ±as todavÃ­a.</p>
      }
    } @else {
      <p>Cargando reseÃ±asâ€¦</p>
    }
  </div>

  <!-- Formulario de nueva reseÃ±a -->
  <div class="review-form">
    <h3>CalificaciÃ³n de los servicios</h3>

    <div class="stars">
      @for (s of stars; track s) {
        <span
          (click)="rating = s"
          [style.color]="rating >= s ? 'orange' : '#ccc'"
          class="star"
        >â˜…</span>
      }
    </div>

    <textarea
      [(ngModel)]="comment"
      placeholder="Describe tu experiencia (opcional)"
      maxlength="500"
    ></textarea>

    <button (click)="sendReview()">Enviar</button>
  </div>
</div>
